<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>AR Portal Experience</title>

    <!-- A-Frame -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

    <link rel="stylesheet" href="/src/styles.css">

    <style>
        /* Camera background video */
        #camera-feed {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 0;
        }

        #ar-scene {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
    </style>
</head>

<body>
    <!-- Camera Feed Background -->
    <video id="camera-feed" autoplay playsinline muted></video>

    <!-- Start Screen - User must tap to begin -->
    <div id="start-screen" class="overlay">
        <div class="start-content">
            <div class="portal-icon">üåÄ</div>
            <h1>AR Portal</h1>
            <p>Experience an augmented reality portal</p>
            <button id="start-btn" class="btn btn-large">Start AR Experience</button>
            <p class="hint">The portal will appear in front of you</p>
        </div>
    </div>

    <!-- Loading Screen -->
    <div id="loading-screen" class="overlay hidden">
        <div class="loading-content">
            <div class="spinner"></div>
            <h2>Initializing AR</h2>
            <p id="loading-status">Requesting camera access...</p>
        </div>
    </div>

    <!-- Permission Error Screen -->
    <div id="permission-error" class="overlay hidden">
        <div class="error-content">
            <div class="error-icon">‚ö†Ô∏è</div>
            <h2>Permissions Required</h2>
            <p id="error-message">Camera access is required for the AR experience.</p>
            <button id="retry-btn" class="btn">Try Again</button>
        </div>
    </div>

    <!-- Portal Info HUD (shown after placement) -->
    <div id="portal-hud" class="hud hidden">
        <div class="portal-card">
            <div class="portal-status">üåÄ Portal Active</div>
            <button id="reset-btn" class="btn btn-small">Reposition</button>
        </div>
    </div>

    <!-- A-Frame 3D Scene (transparent background, overlays camera) -->
    <a-scene id="ar-scene" class="hidden" embedded vr-mode-ui="enabled: false"
        renderer="antialias: true; alpha: true; logarithmicDepthBuffer: true;" background="color: transparent">
        <!-- Portal Entity -->
        <a-entity id="portal" visible="false" position="0 0 -3">
            <!-- Main ellipse portal (torus shape) - laying flat -->
            <a-torus id="portal-ring" radius="0.8" radius-tubular="0.05" segments-radial="64" segments-tubular="32"
                material="color: #8B5CF6; emissive: #7C3AED; emissiveIntensity: 0.6; side: double; transparent: true; opacity: 0.95;"
                rotation="90 0 0"
                animation="property: position; to: 0 0.15 0; dir: alternate; dur: 2000; easing: easeInOutSine; loop: true"
                animation__rotate="property: rotation; from: 90 0 0; to: 90 360 0; dur: 12000; easing: linear; loop: true"></a-torus>

            <!-- Inner glow ring -->
            <a-torus radius="0.6" radius-tubular="0.03" segments-radial="48" segments-tubular="24"
                material="color: #C4B5FD; emissive: #A78BFA; emissiveIntensity: 0.8; transparent: true; opacity: 0.7;"
                rotation="90 0 0"
                animation="property: position; to: 0 0.15 0; dir: alternate; dur: 2000; easing: easeInOutSine; loop: true"
                animation__scale="property: scale; from: 0.95 0.95 0.95; to: 1.08 1.08 1.08; dir: alternate; dur: 1500; easing: easeInOutQuad; loop: true"></a-torus>

            <!-- Outer glow effect -->
            <a-torus radius="1.0" radius-tubular="0.015" segments-radial="48" segments-tubular="16"
                material="color: #DDD6FE; emissive: #C4B5FD; emissiveIntensity: 1; transparent: true; opacity: 0.4;"
                rotation="90 0 0"
                animation="property: position; to: 0 0.15 0; dir: alternate; dur: 2000; easing: easeInOutSine; loop: true"
                animation__opacity="property: material.opacity; from: 0.3; to: 0.6; dir: alternate; dur: 1200; easing: easeInOutSine; loop: true"></a-torus>

            <!-- Portal surface (the dark center) -->
            <a-circle radius="0.55" segments="64"
                material="color: #0a0015; transparent: true; opacity: 0.85; side: double;" rotation="90 0 0"
                animation="property: position; to: 0 0.15 0; dir: alternate; dur: 2000; easing: easeInOutSine; loop: true"></a-circle>

            <!-- Swirling inner effect -->
            <a-circle radius="0.5" segments="64"
                material="color: #7C3AED; transparent: true; opacity: 0.3; side: double;" rotation="90 0 0"
                animation="property: position; to: 0 0.17 0; dir: alternate; dur: 2000; easing: easeInOutSine; loop: true"
                animation__rotate="property: rotation; from: 90 0 0; to: 90 0 -360; dur: 6000; easing: linear; loop: true"></a-circle>

            <!-- Floating particles -->
            <a-sphere position="0.7 0.2 0" radius="0.025"
                material="color: #C4B5FD; emissive: #A78BFA; emissiveIntensity: 1;"
                animation="property: position; to: 0.7 0.5 0; dir: alternate; dur: 1400; easing: easeInOutSine; loop: true"></a-sphere>
            <a-sphere position="-0.65 0.25 0.3" radius="0.02"
                material="color: #DDD6FE; emissive: #C4B5FD; emissiveIntensity: 1;"
                animation="property: position; to: -0.65 0.55 0.3; dir: alternate; dur: 1800; easing: easeInOutSine; loop: true"></a-sphere>
            <a-sphere position="0.35 0.2 -0.6" radius="0.022"
                material="color: #8B5CF6; emissive: #7C3AED; emissiveIntensity: 1;"
                animation="property: position; to: 0.35 0.48 -0.6; dir: alternate; dur: 1100; easing: easeInOutSine; loop: true"></a-sphere>
            <a-sphere position="-0.4 0.18 -0.55" radius="0.015"
                material="color: #C4B5FD; emissive: #A78BFA; emissiveIntensity: 1;"
                animation="property: position; to: -0.4 0.42 -0.55; dir: alternate; dur: 1600; easing: easeInOutSine; loop: true"></a-sphere>
        </a-entity>

        <!-- Camera with device orientation -->
        <a-entity id="camera-rig" position="0 1.6 0">
            <a-camera id="ar-camera"
                look-controls="enabled: true; magicWindowTrackingEnabled: true; touchEnabled: false"
                wasd-controls="enabled: false"></a-camera>
        </a-entity>

        <!-- Ambient light -->
        <a-light type="ambient" color="#ffffff" intensity="0.7"></a-light>
        <a-light type="directional" color="#ffffff" intensity="0.4" position="1 2 1"></a-light>
    </a-scene>

    <script type="module" src="/src/main.js"></script>
</body>

</html>